<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>BSP430: CC3000 SimpleLink Exploration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSP430
   &#160;<span id="projectnumber">20140301</span>
   </div>
   <div id="projectbrief">Board Support Package for MSP430 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">CC3000 SimpleLink Exploration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example is a fairly complex program demonstrating the basic goal that drove BSP430 development: the ability to quickly develop tools to explore new capabilities in an interactive fashion without being tied to a particular MSP430 product line or board, and to abstract the capabilities as modules that could be used in other applications.</p>
<p>The <a href="http://processors.wiki.ti.com/index.php/CC3000_Wi-Fi_for_MCU">Texas Instruments SimpleLink(TM) CC3000 Wi-Fi SOC</a> is a solution intended to enable microcontrollers to communicate over 802.11 Wi-Fi networks. It is available in RF evaluation module form-factor, and comes with example programs from Texas Instruments that are mostly tested only on the <a href="http://www.ti.com/tool/msp-exp430fr5739">MSP-EXP430FR5739 "Fraunchpad"</a>.</p>
<p>The example here uses the TI-provided host driver with a BSP430 SPI interface to provide an interactive program to invoke various capabilities of the SimpleLink hardware. The Fraunchpad has extremely limited memory (16 kB including the space used for the packet buffers) and simply can't support an interactive application with extensive text help and command processing. It's close, though; this application takes slightly more than 20 kB when compiled with <a href="https://sourceforge.net/projects/mspgcc/">MSPGCC</a> for the <a href="http://www.ti.com/tool/msp-exp430f5438">MSP-EXP430F5438</a>.</p>
<p>Below are the commands supported: </p>
<pre class="fragment">&gt; help
help # No help available
info # No help available
  load # load wlan AP params from INFO_B
  erase # erase INFO_B
  store # store wlan AP params in INFO_B
nvmem # No help available
  mac # get mac address
  read fileid [len(=128) [ofs(=0)]] # read block from nvmem file
  sp # read firmware service pack level
wlan # No help available
  start # power-up CC3000
  status # get CC3000 status and AP config
  connect # connect to specified access point using AP config
  sectype [{sectype}] # Display or set AP sectype
  passphrase [{passphrase}] # Display or set AP passphrase
  ssid [{ssid}] # Display or set AP SSID for connect
  ipconfig # show IP parameters
  disconnect # disconnect from AP
  stop # shut down CC3000
</pre><p>A demonstration boot sequence with a couple commands is: </p>
<pre class="fragment">WLAN test program
System reset bitmask 4; causes:
        RST/NMI
System reset included: BOR POR PUC
PWR_EN at PORT1.7
SPI_IRQ HAL at PORT1.3
CSn HAL at PORT3.0
SPI is USCI5_B0
SPI Pins: MOSI/SDA=P3.1; MISO/SCL=P3.2; CLK=P3.3; STE=P3.0
Oct  2 2012 13:43:22
 0:00.771 Initialize returned 0
And wlan has been started.
AP configuration SSID 'myssid', passphrase 'mypassphrase'
AP security type wpa (2)
WLAN status 0: disconnected
&gt; wla co
connect to ssid 'myssid' by wpa using 'mypassphrase'
con 0 in  0:06.365
 0:12.506 wlan_cb 0x8200 0 at 0 SR 0x1
&gt;  0:13.220 wlan_cb 0x8001 0 at 0 SR 0x1
 0:22.306 wlan_cb 0x8010 20 at 0x5bbe SR 0
 0:22.487 wlan_cb 0x8200 0 at 0 SR 0x1
w ip
IP: 192.168.0.101
NM: 255.255.255.0
GW: 192.168.0.1
DHCP: 192.168.0.1
DNS: 192.168.0.1
MAC: 00.25.ca.02.09.9d
SSID: myssid
&gt;  0:32.486 wlan_cb 0x8200 0 at 0 SR 0x1
</pre><p>Note that asynchronous callbacks from the host driver are displayed interspersed with the commands, and that in this case the AP configuration parameters had been stored in information memory and reloaded on power-up.</p>
<p>Experience while reaching this point revealed that the SimpleLink solution is too immature for serious development, and it is unlikely that the example will be evolved further. Nonetheless, it's a good demonstration of BSP430's capabilities.</p>
<p>To build the program, you will need a copy of the CC3000 Host Driver. This application uses one that has been repackaged to place header files out of the application namespace, support MSPGCC, fix a few bugs, and support building as a library that can be linked into an application. It can be obtained from: <a href="http://github.com/pabigot/cc3000">http://github.com/pabigot/cc3000</a></p>
<h1><a class="anchor" id="ex_rf_cc3000_spi"></a>
cc3000spi.c</h1>
<p>The CC3000 Host Driver library is independent of the underlying interface via SPI. A demonstration interface for specific MSP430 processors is part of the TI example programs, but it is rather confusing and has board-specific material tightly integrated.</p>
<p>The file below bridges between the host driver and BSP430's serial abstraction following the specfication at the <a href="http://processors.wiki.ti.com/index.php/CC3000_Host_Driver_Porting_Guide">CC3000 Host Driver Porting Guide</a>.</p>
<div class="fragment"><div class="line"><span class="comment">/* Copyright 2012-2014, Peter A. Bigot</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> * modification, are permitted provided that the following conditions are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * * Redistributions of source code must retain the above copyright notice,</span></div>
<div class="line"><span class="comment"> *   this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * * Redistributions in binary form must reproduce the above copyright notice,</span></div>
<div class="line"><span class="comment"> *   this list of conditions and the following disclaimer in the documentation</span></div>
<div class="line"><span class="comment"> *   and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * * Neither the name of the software nor the names of its contributors may be</span></div>
<div class="line"><span class="comment"> *   used to endorse or promote products derived from this software without</span></div>
<div class="line"><span class="comment"> *   specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span></div>
<div class="line"><span class="comment"> * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span></div>
<div class="line"><span class="comment"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span></div>
<div class="line"><span class="comment"> * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE</span></div>
<div class="line"><span class="comment"> * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span></div>
<div class="line"><span class="comment"> * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span></div>
<div class="line"><span class="comment"> * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span></div>
<div class="line"><span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span></div>
<div class="line"><span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span></div>
<div class="line"><span class="comment"> * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span></div>
<div class="line"><span class="comment"> * POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="platform_8h.html">bsp430/platform.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="uptime_8h.html">bsp430/utility/uptime.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="port_8h.html">bsp430/periph/port.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="serial_8h.html">bsp430/serial.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="cc3000spi_8h.html">cc3000spi.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/wlan.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/hci.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/spi.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(__MSP430FR5739__)</span></div>
<div class="line">__attribute__((__section__(<span class="stringliteral">&quot;.rodata&quot;</span>)))</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* __MSP430FR5739__ */</span><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> wlan_tx_buffer[<a class="code" href="cc3000spi_8h.html#a91296e239f43b23894ff57a3d196a644">BSP430_CC3000SPI_TX_BUFFER_SIZE</a>];</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(__MSP430FR5739__)</span></div>
<div class="line">__attribute__((__section__(<span class="stringliteral">&quot;.rodata&quot;</span>)))</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* __MSP430FR5739__ */</span><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> wlan_rx_buffer[<a class="code" href="cc3000spi_8h.html#ad0be8d9dad7f10d193314afbb436822e">BSP430_CC3000SPI_RX_BUFFER_SIZE</a>];</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define SPIFLAG_INITIALIZED 0x01</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define SPIFLAG_DID_FIRST_WRITE 0x02</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define CC3000_SPI_OPCODE_WRITE 1</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define CC3000_SPI_OPCODE_READ 3</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> spiFlags_v_;</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430halSERIAL.html">hBSP430halSERIAL</a> spi_;</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430halPORT.html">hBSP430halPORT</a> halCSn_;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <a class="code" href="structsBSP430hplPORT__IE__8.html">sBSP430hplPORTIE</a> * spiIRQport_;</div>
<div class="line"><span class="keyword">static</span> gcSpiHandleRx rxCallback_ni_;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Assert chip select by clearing CSn */</span></div>
<div class="line"><span class="preprocessor">#define CS_ASSERT() do {                                                \</span></div>
<div class="line"><span class="preprocessor">    BSP430_PORT_HAL_HPL_OUT(halCSn_) &amp;= ~BSP430_RF_CC3000_CSn_PORT_BIT; \</span></div>
<div class="line"><span class="preprocessor">  } while (0)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* De-assert chip select by setting CSn */</span></div>
<div class="line"><span class="preprocessor">#define CS_DEASSERT() do {                                              \</span></div>
<div class="line"><span class="preprocessor">    BSP430_PORT_HAL_HPL_OUT(halCSn_) |= BSP430_RF_CC3000_CSn_PORT_BIT;  \</span></div>
<div class="line"><span class="preprocessor">  } while (0)</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Implementation of tWlanReadInterruptPin for wlan_init().</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This is used in wlan_start() to detect that the CC3000 has</span></div>
<div class="line"><span class="comment"> * successfully powered up. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">long</span></div>
<div class="line">readWlanInterruptPin_ (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> spiIRQport_-&gt;in &amp; BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Implementation of tWlanInterruptEnable for wlan_init().</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Required by the interface, but not used by the host driver</span></div>
<div class="line"><span class="comment"> * implementation.  Used internally. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">wlanInterruptEnable_ (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  spiIRQport_-&gt;ie |= BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Implementation of tWlanInterruptDisable for wlan_init().</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Required by the interface, but not used by the host driver</span></div>
<div class="line"><span class="comment"> * implementation.  Used internally.  */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">wlanInterruptDisable_ (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  spiIRQport_-&gt;ie &amp;= ~BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Implementation of tWriteWlanPin for wlan_init().</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This is used in wlan_start() to power-up the CC3000, and in</span></div>
<div class="line"><span class="comment"> * wlan_stop() to shut it down again. */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">writeWlanPin_ (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> val)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE</span></div>
<div class="line">  <span class="keyword">volatile</span> <a class="code" href="structsBSP430hplPORT__IE__8.html">sBSP430hplPORTIE</a> * <span class="keyword">const</span> pwr_en_port = <a class="code" href="port_8h.html#ab315de00d9b9e34a6bb772103b05f0f8">xBSP430hplLookupPORTIE</a>(BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Done correctly, the application always starts with this disabled</span></div>
<div class="line"><span class="comment">   * (by SpiOpen), then enables it (later in wlan_start()) then</span></div>
<div class="line"><span class="comment">   * disables it (in wlan_stop()), always alternating.  For internal</span></div>
<div class="line"><span class="comment">   * consistency, always assume we&#39;re turning things off, and change</span></div>
<div class="line"><span class="comment">   * them to on only by request.  Specifically, we want the</span></div>
<div class="line"><span class="comment">   * spiFlags_v_ to be cleared when the PWR_EN line is low. */</span></div>
<div class="line">  pwr_en_port-&gt;out &amp;= ~BSP430_RF_CC3000_PWR_EN_PORT_BIT;</div>
<div class="line">  spiFlags_v_ &amp;= ~SPIFLAG_INITIALIZED;</div>
<div class="line">  <span class="keywordflow">if</span> (val) {</div>
<div class="line">    pwr_en_port-&gt;out |= BSP430_RF_CC3000_PWR_EN_PORT_BIT;</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line"><a class="code" href="cc3000spi_8h.html#a18c48988f94c6984548d28e802377344">iBSP430cc3000spiInitialize</a> (tWlanCB wlan_cb,</div>
<div class="line">                            tFWPatches firmware_patch_fn,</div>
<div class="line">                            tDriverPatches driver_patch_fn,</div>
<div class="line">                            tBootLoaderPatches boot_loader_patch_fn)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (NULL == <a class="code" href="serial_8h.html#ad311104b2da6d177b2ae5ec0b29e7207">hBSP430serialLookup</a>(BSP430_RF_CC3000_SPI_PERIPH_HANDLE)) {</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  spiIRQport_ = <a class="code" href="port_8h.html#ab315de00d9b9e34a6bb772103b05f0f8">xBSP430hplLookupPORTIE</a>(BSP430_RF_CC3000_IRQn_PORT_PERIPH_HANDLE);</div>
<div class="line">  <span class="keywordflow">if</span> (NULL == spiIRQport_) {</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  halCSn_ = <a class="code" href="port_8h.html#a039c56ddc64f51922244aac149f7a853">hBSP430portLookup</a>(BSP430_RF_CC3000_CSn_PORT_PERIPH_HANDLE);</div>
<div class="line">  <span class="keywordflow">if</span> (NULL == halCSn_) {</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  wlan_init(wlan_cb, firmware_patch_fn, driver_patch_fn, boot_loader_patch_fn,</div>
<div class="line">            readWlanInterruptPin_, wlanInterruptEnable_, wlanInterruptDisable_,</div>
<div class="line">            writeWlanPin_);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">processSpiIRQ_ (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structsBSP430halISRIndexedChainNode.html">sBSP430halISRIndexedChainNode</a> * cb,</div>
<div class="line">                <span class="keywordtype">void</span> * context,</div>
<div class="line">                <span class="keywordtype">int</span> idx)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (spiFlags_v_ &amp; SPIFLAG_INITIALIZED) {</div>
<div class="line">    <span class="keywordtype">int</span> rv;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> opcode = CC3000_SPI_OPCODE_READ;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * rp;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* This is a signal that data is available.  Read it.  Yes, right</span></div>
<div class="line"><span class="comment">     * here in the ISR.  The host driver API would need to be</span></div>
<div class="line"><span class="comment">     * integrated with a multi-tasking OS to do it elsewhere, since</span></div>
<div class="line"><span class="comment">     * it&#39;s not event-driven at the user level. */</span></div>
<div class="line">    CS_ASSERT();</div>
<div class="line">    <span class="comment">/* Read the header.  From that we&#39;ll extract the length. */</span></div>
<div class="line">    rp = wlan_rx_buffer;</div>
<div class="line">    rv = <a class="code" href="serial_8h.html#a7646c9d6044dcc9729b72cf9e559fa55">iBSP430spiTxRx_rh</a>(spi_, &amp;opcode, <span class="keyword">sizeof</span>(opcode), SPI_HEADER_SIZE-<span class="keyword">sizeof</span>(opcode), rp);</div>
<div class="line">    <span class="keywordflow">if</span> (SPI_HEADER_SIZE == rv) {</div>
<div class="line">      len = (wlan_rx_buffer[HCI_PACKET_LENGTH_OFFSET] &lt;&lt; 8) | wlan_rx_buffer[1 + HCI_PACKET_LENGTH_OFFSET];</div>
<div class="line">      rp += SPI_HEADER_SIZE;</div>
<div class="line">      rv = <a class="code" href="serial_8h.html#a7646c9d6044dcc9729b72cf9e559fa55">iBSP430spiTxRx_rh</a>(spi_, NULL, 0, len, rp);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      rv = -1;</div>
<div class="line">    }</div>
<div class="line">    CS_DEASSERT();</div>
<div class="line">    <span class="keywordflow">if</span> (0 &lt; rv) {</div>
<div class="line">      <span class="comment">/* Turn off the interrupt while we process this message.  The</span></div>
<div class="line"><span class="comment">       * driver will invoke SpiResume() to turn it back on. */</span></div>
<div class="line">      wlanInterruptDisable_();</div>
<div class="line"></div>
<div class="line">      <span class="comment">/* Pass the packet off to the driver.  Again, yes, right here in</span></div>
<div class="line"><span class="comment">       * the ISR. */</span></div>
<div class="line">      rxCallback_ni_(rp);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">/* If not initialized, this is the IRQ raised by the CC3000 to</span></div>
<div class="line"><span class="comment">     * notify the MCU that it is now powered up and active.  No data</span></div>
<div class="line"><span class="comment">     * to read, no callback to invoke. */</span></div>
<div class="line">    spiFlags_v_ |= SPIFLAG_INITIALIZED;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430halISRIndexedChainNode.html">sBSP430halISRIndexedChainNode</a> spi_irq_cb = { .<a class="code" href="structsBSP430halISRIndexedChainNode.html#a3726d70cbcb08d21af047ae60daed1ba">callback_ni</a> = processSpiIRQ_ };</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">SpiOpen (gcSpiHandleRx pfRxHandler)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <a class="code" href="structsBSP430halPORT.html">hBSP430halPORT</a> spi_irq_hal = <a class="code" href="port_8h.html#a039c56ddc64f51922244aac149f7a853">hBSP430portLookup</a>(BSP430_RF_CC3000_IRQn_PORT_PERIPH_HANDLE);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> spi_irq_pin = <a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(BSP430_RF_CC3000_IRQn_PORT_BIT);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    <span class="keywordflow">if</span> (spi_) {</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Open the device for 3-wire SPI.  Per</span></div>
<div class="line"><span class="comment">     * http://processors.wiki.ti.com/index.php/CC3000_Host_Programming_Guide#CC3000_SPI_Operation</span></div>
<div class="line"><span class="comment">     * the CC3000 can accept clock speeds up to 26MHz, so we might as</span></div>
<div class="line"><span class="comment">     * well just use undivided SMCLK. */</span></div>
<div class="line">    spi_ = <a class="code" href="serial_8h.html#a40983f5ed625fd352698117786691dd5">hBSP430serialOpenSPI</a>(<a class="code" href="serial_8h.html#ad311104b2da6d177b2ae5ec0b29e7207">hBSP430serialLookup</a>(BSP430_RF_CC3000_SPI_PERIPH_HANDLE),</div>
<div class="line">                                <a class="code" href="serial_8h.html#a84cdc2d11d71d5fd97b96f427c239cb9">BSP430_SERIAL_ADJUST_CTL0_INITIALIZER</a>(<a class="code" href="msp430_8h.html#a199ca0dc5cd21e551af5c23d9beec934">UCMSB</a> | <a class="code" href="msp430_8h.html#a83010f7d75e7283b79244ce5a4fa7870">UCMST</a>),</div>
<div class="line">                                <a class="code" href="msp430_8h.html#a1d80b08053e2c8dcad61e17d520da303">UCSSEL_2</a>, 1);</div>
<div class="line">    <span class="keywordflow">if</span> (! spi_) {</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Clear the SPI flags */</span></div>
<div class="line">    spiFlags_v_ = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Preserve the callback pointer */</span></div>
<div class="line">    rxCallback_ni_ = pfRxHandler;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">volatile</span> <a class="code" href="structsBSP430hplPORT__IE__8.html">sBSP430hplPORTIE</a> * <span class="keyword">const</span> pwr_en_port = <a class="code" href="port_8h.html#ab315de00d9b9e34a6bb772103b05f0f8">xBSP430hplLookupPORTIE</a>(BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE);</div>
<div class="line"></div>
<div class="line">      <span class="comment">/* Configure CC3000 power-enable pin and turn off power.  It&#39;ll be</span></div>
<div class="line"><span class="comment">       * turned on in wlan_start() after this function returns. */</span></div>
<div class="line">      pwr_en_port-&gt;out &amp;= ~BSP430_RF_CC3000_PWR_EN_PORT_BIT;</div>
<div class="line">      pwr_en_port-&gt;dir |= BSP430_RF_CC3000_PWR_EN_PORT_BIT;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Clear chip select (set value before making it an output) */</span></div>
<div class="line">    CS_DEASSERT();</div>
<div class="line">    <a class="code" href="port_8h.html#ac683406c979412b4cdcbe0a6bebdea59">BSP430_PORT_HAL_HPL_DIR</a>(halCSn_) |= BSP430_RF_CC3000_CSn_PORT_BIT;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Hook into the interrupt vector for the SPI IRQ, then enable</span></div>
<div class="line"><span class="comment">     * interrupts on falling edge.  When wlan_start() turns on power,</span></div>
<div class="line"><span class="comment">     * we&#39;ll get an interrupt indicating the chip is ready (wlan_start()</span></div>
<div class="line"><span class="comment">     * also busy-waits internally for this event). */</span></div>
<div class="line">    spi_irq_cb.<a class="code" href="structsBSP430halISRIndexedChainNode.html#a851667834657abc24fa702f2ead92271">next_ni</a> = spi_irq_hal-&gt;<a class="code" href="structsBSP430halPORT.html#a28764754654e75149e6d4f40805ff46a">pin_cbchain_ni</a>[spi_irq_pin];</div>
<div class="line">    spi_irq_hal-&gt;<a class="code" href="structsBSP430halPORT.html#a28764754654e75149e6d4f40805ff46a">pin_cbchain_ni</a>[spi_irq_pin] = &amp;spi_irq_cb;</div>
<div class="line">    spiIRQport_-&gt;ies |= BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">    spiIRQport_-&gt;dir &amp;= ~BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">    spiIRQport_-&gt;ifg &amp;= ~BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">    wlanInterruptEnable_();</div>
<div class="line">  } <span class="keywordflow">while</span> (0);</div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">SpiClose (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <a class="code" href="structsBSP430halPORT.html">hBSP430halPORT</a> spi_irq_hal = <a class="code" href="port_8h.html#a039c56ddc64f51922244aac149f7a853">hBSP430portLookup</a>(BSP430_RF_CC3000_IRQn_PORT_PERIPH_HANDLE);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> spi_irq_pin = <a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(BSP430_RF_CC3000_IRQn_PORT_BIT);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    <span class="keywordflow">if</span> (! spi_) {</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Disable interrupts, clear pending interrupt, and unhook from</span></div>
<div class="line"><span class="comment">     * the ISR chain.  Set the GPIO to output low. */</span></div>
<div class="line">    tSLInformation.WlanInterruptDisable();</div>
<div class="line">    spiIRQport_-&gt;ifg &amp;= ~BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">    spi_irq_hal-&gt;<a class="code" href="structsBSP430halPORT.html#a28764754654e75149e6d4f40805ff46a">pin_cbchain_ni</a>[spi_irq_pin] = spi_irq_cb.<a class="code" href="structsBSP430halISRIndexedChainNode.html#a851667834657abc24fa702f2ead92271">next_ni</a>;</div>
<div class="line">    spiIRQport_-&gt;out &amp;= ~BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line">    spiIRQport_-&gt;dir |= BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Close down SPI peripheral */</span></div>
<div class="line">    (void)<a class="code" href="serial_8h.html#a9ef360a3a47ffaef50409a14fbffe5d2">iBSP430serialClose</a>(spi_);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Release the chip select line, just for completeness. */</span></div>
<div class="line">    CS_DEASSERT();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keyword">volatile</span> <a class="code" href="structsBSP430hplPORT__IE__8.html">sBSP430hplPORTIE</a> * <span class="keyword">const</span> pwr_en_port = <a class="code" href="port_8h.html#ab315de00d9b9e34a6bb772103b05f0f8">xBSP430hplLookupPORTIE</a>(BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE);</div>
<div class="line"></div>
<div class="line">      <span class="comment">/* Power down the CC3000.  In fact, this was already done by</span></div>
<div class="line"><span class="comment">       * wlan_stop(). */</span></div>
<div class="line">      pwr_en_port-&gt;out &amp;= ~BSP430_RF_CC3000_PWR_EN_PORT_BIT;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">    rxCallback_ni_ = NULL;</div>
<div class="line">    spi_ = NULL;</div>
<div class="line">  } <span class="keywordflow">while</span> (0);</div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">long</span></div>
<div class="line">SpiWrite (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * tx_buffer,</div>
<div class="line">          <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> len)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * tp = tx_buffer;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Total length of packet must be an even number of octets.  Packet</span></div>
<div class="line"><span class="comment">   * length is user-provided length plus the length of the SPI header,</span></div>
<div class="line"><span class="comment">   * which happens to be odd.  Pad the payload if necessary. */</span></div>
<div class="line">  <span class="keywordflow">if</span> (0x01 &amp; (len + SPI_HEADER_SIZE)) {</div>
<div class="line">    ++len;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* The caller-provided tx_buffer includes SPI_HEADER_SIZE octets at</span></div>
<div class="line"><span class="comment">   * the front, ready for our use. */</span></div>
<div class="line">  *tp++ = CC3000_SPI_OPCODE_WRITE;</div>
<div class="line">  *tp++ = len &gt;&gt; 8;</div>
<div class="line">  *tp++ = len &amp; 0x0FF;</div>
<div class="line">  *tp++ = 0;</div>
<div class="line">  *tp++ = 0;</div>
<div class="line">  len += SPI_HEADER_SIZE;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line"></div>
<div class="line">  CS_ASSERT();</div>
<div class="line">  <span class="comment">/* Spin waiting for acknowledgement, then clear the flag that would</span></div>
<div class="line"><span class="comment">   * look like a read request when we exit.  If we collided with a</span></div>
<div class="line"><span class="comment">   * read request from the CC3000, it&#39;ll re-assert after we&#39;re done</span></div>
<div class="line"><span class="comment">   * writing (per</span></div>
<div class="line"><span class="comment">   * http://processors.wiki.ti.com/index.php/CC3000_Host_Driver_Porting_Guide#Handling_Collision) */</span></div>
<div class="line">  <span class="keywordflow">while</span> (0 != readWlanInterruptPin_()) {</div>
<div class="line">    ;</div>
<div class="line">  }</div>
<div class="line">  spiIRQport_-&gt;ifg &amp;= ~BSP430_RF_CC3000_IRQn_PORT_BIT;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Special handling for first write.  See</span></div>
<div class="line"><span class="comment">   * http://processors.wiki.ti.com/index.php/CC3000_Serial_Port_Interface_%28SPI%29#First_Host_Write_Operation */</span></div>
<div class="line">  tp = tx_buffer;</div>
<div class="line">  <span class="keywordflow">if</span> (! (spiFlags_v_ &amp; SPIFLAG_DID_FIRST_WRITE)) {</div>
<div class="line">    <a class="code" href="core_8h.html#a3124959aa09ef7d745fb63c9ff5ee897">BSP430_CORE_DELAY_CYCLES</a>((50 * <a class="code" href="clock_8h.html#a6ffd3f4fab35b64d0e8ff8d3179d69d9">BSP430_CLOCK_NOMINAL_MCLK_HZ</a>) / 1000000UL);</div>
<div class="line">    rv = <a class="code" href="serial_8h.html#a7646c9d6044dcc9729b72cf9e559fa55">iBSP430spiTxRx_rh</a>(spi_, tp, 4, 0, NULL);</div>
<div class="line">    tp += 4;</div>
<div class="line">    len -= 4;</div>
<div class="line">    <a class="code" href="core_8h.html#a3124959aa09ef7d745fb63c9ff5ee897">BSP430_CORE_DELAY_CYCLES</a>((50 * <a class="code" href="clock_8h.html#a6ffd3f4fab35b64d0e8ff8d3179d69d9">BSP430_CLOCK_NOMINAL_MCLK_HZ</a>) / 1000000UL);</div>
<div class="line">    spiFlags_v_ |= SPIFLAG_DID_FIRST_WRITE;</div>
<div class="line">  }</div>
<div class="line">  rv = <a class="code" href="serial_8h.html#a7646c9d6044dcc9729b72cf9e559fa55">iBSP430spiTxRx_rh</a>(spi_, tp, len, 0, NULL);</div>
<div class="line">  CS_DEASSERT();</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> (0 &lt;= rv) ? rv : 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Driver calls this to restore interrupts after processing an</span></div>
<div class="line"><span class="comment"> * incoming message. */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">SpiResumeSpi (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  wlanInterruptEnable_();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="ex_rf_cc3000_main"></a>
main.c</h1>
<p>The bulk of the application is taken up with bridge code that interprets user input and invokes CC3000 host API calls. It is mostly of interest in that it demonstrates how to arrange command definitions so they can be easily included/excluded based on available memory.</p>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="platform_8h.html">bsp430/platform.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="clock_8h.html">bsp430/clock.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="port_8h.html">bsp430/periph/port.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sys_8h.html">bsp430/periph/sys.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="flash_8h.html">bsp430/periph/flash.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="pmm_8h.html">bsp430/periph/pmm.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/crtld.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="uptime_8h.html">bsp430/utility/uptime.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="console_8h.html">bsp430/utility/console.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="led_8h.html">bsp430/utility/led.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cli_8h.html">bsp430/utility/cli.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="cc3000spi_8h.html">cc3000spi.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/host_driver_version.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/wlan.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/nvmem.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/netapp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/hci.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/security.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cc3000/socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Memory is extremely tight on the FR5739 (16 kB including CC3000</span></div>
<div class="line"><span class="comment"> * buffers).  Set these to restrict the set of commands to ones of</span></div>
<div class="line"><span class="comment"> * interest that will fit.  You&#39;ll probably find you&#39;ll need to</span></div>
<div class="line"><span class="comment"> * disable WLAN_CONNECT, which makes this pretty useless.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * On the EXP430G2 there isn&#39;t enough memory to do anything, so</span></div>
<div class="line"><span class="comment"> * disable everything.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * No issues on the &quot;real&quot; chips: MSP430F5438, MSP430F5529, .... */</span></div>
<div class="line"><span class="preprocessor">#if ! (BSP430_PLATFORM_EXP430G2 - 0)</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_BROKEN 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_STOP 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_STATUS 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_CONNECT 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_IPCONFIG 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_DISCONNECT 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_START 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_PROFILE 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_WLAN_SMART 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_NVMEM 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_NVMEM_SP 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_NVMEM_READ 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_NVMEM_MAC 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_SCAN 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_INFO 1</span></div>
<div class="line"><span class="preprocessor">#define CMD_HELP 1</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CC3000BOOST */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (NO_HELP - 0)</span></div>
<div class="line"><span class="preprocessor">#define HELP_STRING(h_) NULL</span></div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* NO_HELP */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define HELP_STRING(h_) h_</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* NO_HELP */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define MAGIC_CONNECT_PARAMS 0x3000</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>sConnectParams {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> magic;</div>
<div class="line">  <span class="keywordtype">int</span> security_type;</div>
<div class="line">  <span class="keywordtype">size_t</span> ssid_len;</div>
<div class="line">  <span class="keywordtype">size_t</span> passphrase_len;</div>
<div class="line">  <span class="keywordtype">char</span> ssid[33];</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> passphrase[65];</div>
<div class="line">} sConnectParams;</div>
<div class="line"></div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lastKeepAlive_utt;</div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> lastCallback_utt;</div>
<div class="line"><span class="keyword">volatile</span> <span class="keywordtype">long</span> lastEventType;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> wlan_cb (<span class="keywordtype">long</span> event_type,</div>
<div class="line">                     <span class="keywordtype">char</span> * data,</div>
<div class="line">                     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> length)</div>
<div class="line">{</div>
<div class="line">  lastEventType = event_type;</div>
<div class="line">  lastCallback_utt = <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Ignore unsolicited keep-alives, which occur every 10 seconds</span></div>
<div class="line"><span class="comment">   * whenever the WLAN has been started, regardless of whether it&#39;s</span></div>
<div class="line"><span class="comment">   * connected or scanning. */</span></div>
<div class="line">  <span class="keywordflow">if</span> (HCI_EVNT_WLAN_KEEPALIVE == event_type) {</div>
<div class="line">    lastKeepAlive_utt = lastCallback_utt;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%s wlan_cb %#lx %u at %p SR %#x\n&quot;</span>,</div>
<div class="line">          <a class="code" href="uptime_8h.html#a790fc3c41c4a8e93ec7caca7825733c1">xBSP430uptimeAsText_ni</a>(lastCallback_utt),</div>
<div class="line">          event_type, length, data, __read_status_register());</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">displayMemory (<span class="keyword">const</span> uint8_t * dp,</div>
<div class="line">               <span class="keywordtype">size_t</span> len,</div>
<div class="line">               uintptr_t offset)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> asciiz[17];</div>
<div class="line">  <span class="keyword">const</span> uint8_t * <span class="keyword">const</span> dpe = dp + len;</div>
<div class="line">  <span class="keywordtype">char</span> * ap;</div>
<div class="line"></div>
<div class="line">  ap = asciiz;</div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line">    <span class="keywordflow">if</span> (0 == (offset % 16)) {</div>
<div class="line">      <span class="keywordflow">if</span> (asciiz &lt; ap) {</div>
<div class="line">        *ap = 0;</div>
<div class="line">        <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;    %s\n&quot;</span>, asciiz);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">if</span> (dp &gt;= dpe) {</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%04x &quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)offset);</div>
<div class="line">      ap = asciiz;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == (offset % 8)) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    ++offset;</div>
<div class="line">    <span class="keywordflow">if</span> (dp &lt; dpe) {</div>
<div class="line">      *ap++ = isprint(*dp) ? *dp : <span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot; %02x&quot;</span>, *dp);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;   &quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    ++dp;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> * commandSet;</div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND NULL</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN - 0)</span></div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND NULL</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_STOP - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_stop (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  wlan_stop();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_stop = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;stop&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# shut down CC3000&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_stop</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_stop</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_STOP */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_DISCONNECT - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_disconnect (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> rl = wlan_disconnect();</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;disconnect returned %ld\n&quot;</span>, rl);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_disconnect = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;disconnect&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# disconnect from AP&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_disconnect</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_disconnect</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_DISCONNECT */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_IPCONFIG - 0)</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line">ipv4AsText (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * ipaddr)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> buffer[16];</div>
<div class="line">  snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%u.%u.%u.%u&quot;</span>, ipaddr[3], ipaddr[2], ipaddr[1], ipaddr[0]);</div>
<div class="line">  <span class="keywordflow">return</span> buffer;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_ipconfig (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  tNetappIpconfigRetArgs ipc;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> * p;</div>
<div class="line"></div>
<div class="line">  memset(&amp;ipc, 0, <span class="keyword">sizeof</span>(ipc));</div>
<div class="line">  netapp_ipconfig(&amp;ipc);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;IP: %s\n&quot;</span>, ipv4AsText(ipc.aucIP));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;NM: %s\n&quot;</span>, ipv4AsText(ipc.aucSubnetMask));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;GW: %s\n&quot;</span>, ipv4AsText(ipc.aucDefaultGateway));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;DHCP: %s\n&quot;</span>, ipv4AsText(ipc.aucDHCPServer));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;DNS: %s\n&quot;</span>, ipv4AsText(ipc.aucDNSServer));</div>
<div class="line">  p = ipc.uaMacAddr;</div>
<div class="line">  <span class="comment">/* WTF?  A little-endian MAC address?  This may be because of a bug</span></div>
<div class="line"><span class="comment">   * fix in the host driver; the original version was completely</span></div>
<div class="line"><span class="comment">   * wrong. */</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;MAC: %02x.%02x.%02x.%02x.%02x.%02x\n&quot;</span>,</div>
<div class="line">          p[5], p[4], p[3], p[2], p[1], p[0]);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;SSID: %s\n&quot;</span>, ipc.uaSSID);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_ipconfig = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;ipconfig&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# show IP parameters&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_ipconfig</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_ipconfig</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_IPCONFIG */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>sWlanSecMap {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * tag;</div>
<div class="line">} sWlanSecMap;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> sWlanSecMap wlanSecMap[] = {</div>
<div class="line">  { WLAN_SEC_UNSEC, <span class="stringliteral">&quot;unsec&quot;</span> },</div>
<div class="line">  { WLAN_SEC_WEP, <span class="stringliteral">&quot;wep&quot;</span> },</div>
<div class="line">  { WLAN_SEC_WPA, <span class="stringliteral">&quot;wpa&quot;</span> },</div>
<div class="line">  { WLAN_SEC_WPA2, <span class="stringliteral">&quot;wpa2&quot;</span> },</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> sWlanSecMap * <span class="keyword">const</span> wlanSecMap_end = wlanSecMap + <span class="keyword">sizeof</span>(wlanSecMap)/<span class="keyword">sizeof</span>(*wlanSecMap);</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> sWlanSecMap * wlanSecMapFromValue (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> sWlanSecMap * mp;</div>
<div class="line">  <span class="keywordflow">for</span> (mp = wlanSecMap; mp &lt; wlanSecMap_end; ++mp) {</div>
<div class="line">    <span class="keywordflow">if</span> (mp-&gt;val == val) {</div>
<div class="line">      <span class="keywordflow">return</span> mp;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> sWlanSecMap * wlanSecMapFromTag (<span class="keyword">const</span> <span class="keywordtype">char</span> * tag)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> sWlanSecMap * mp;</div>
<div class="line">  <span class="keywordflow">for</span> (mp = wlanSecMap; mp &lt; wlanSecMap_end; ++mp) {</div>
<div class="line">    <span class="keywordflow">if</span> (0 == strcmp(mp-&gt;tag, tag)) {</div>
<div class="line">      <span class="keywordflow">return</span> mp;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_CONNECT - 0)</span></div>
<div class="line"></div>
<div class="line">sConnectParams connectParams;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_sectype (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> remaining = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">size_t</span> len;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * tp;</div>
<div class="line">  <span class="keyword">const</span> sWlanSecMap * mp;</div>
<div class="line"></div>
<div class="line">  tp = <a class="code" href="group__grp__utility__cli__hci.html#gabcda3dd127008a5cdcc5f40cac4e9e68">xBSP430cliNextQToken</a>(&amp;argstr, &amp;remaining, &amp;len);</div>
<div class="line">  <span class="keywordflow">if</span> (0 &lt; len) {</div>
<div class="line">    mp = wlanSecMapFromTag(tp);</div>
<div class="line">    <span class="keywordflow">if</span> (0 != mp) {</div>
<div class="line">      connectParams.security_type = mp-&gt;val;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ERR: Unrecognized sectype &#39;%s&#39;: valid are&quot;</span>, tp);</div>
<div class="line">      <span class="keywordflow">for</span> (mp = wlanSecMap; mp &lt; wlanSecMap_end; ++mp) {</div>
<div class="line">        <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot; %s&quot;</span>, mp-&gt;tag);</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  mp = wlanSecMapFromValue(connectParams.security_type);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;AP security type is %s (%u)\n&quot;</span>, (mp ? mp-&gt;tag : <span class="stringliteral">&quot;&lt;UNDEF&gt;&quot;</span>), connectParams.security_type);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_ssid (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> remaining = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">size_t</span> len;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * tp;</div>
<div class="line"></div>
<div class="line">  tp = <a class="code" href="group__grp__utility__cli__hci.html#gabcda3dd127008a5cdcc5f40cac4e9e68">xBSP430cliNextQToken</a>(&amp;argstr, &amp;remaining, &amp;len);</div>
<div class="line">  <span class="keywordflow">if</span> (0 &lt; len) {</div>
<div class="line">    memcpy(connectParams.ssid, tp, len);</div>
<div class="line">    connectParams.ssid[len] = 0;</div>
<div class="line">    connectParams.ssid_len = len;</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;AP SSID is %s (%u chars)\n&quot;</span>, connectParams.ssid, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)connectParams.ssid_len);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_passphrase (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> remaining = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">size_t</span> len;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * tp;</div>
<div class="line"></div>
<div class="line">  tp = <a class="code" href="group__grp__utility__cli__hci.html#gabcda3dd127008a5cdcc5f40cac4e9e68">xBSP430cliNextQToken</a>(&amp;argstr, &amp;remaining, &amp;len);</div>
<div class="line">  <span class="keywordflow">if</span> (0 &lt; len) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(connectParams.passphrase) &lt;= (len+1)) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ERR: Passphrase too long (&gt; %u chars + EOS)\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(connectParams.passphrase));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">      memcpy(connectParams.passphrase, tp, len);</div>
<div class="line">      connectParams.passphrase[len] = 0;</div>
<div class="line">      connectParams.passphrase_len = len;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;AP passphrase is &#39;%s&#39; (%u chars)\n&quot;</span>, connectParams.passphrase, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)connectParams.passphrase_len);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_autocon (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> should_connect_to_open_ap = 0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> should_use_fast_connect = 1;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> auto_start = 1;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Analysis shows:</span></div>
<div class="line"><span class="comment">   * should_connect_to_open_ap in NVS at 0x44 32-bit int</span></div>
<div class="line"><span class="comment">   * should_use_fast_connect in NVS at 0x48 32-bit int</span></div>
<div class="line"><span class="comment">   * auto_start in NVS at 0x50 32-bit int */</span></div>
<div class="line">  rv = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;should_connect_to_open_ap);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rv) {</div>
<div class="line">    rv = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;should_use_fast_connect);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rv) {</div>
<div class="line">    rv = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;auto_start);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Connection policy: open_ap=%u fast_connect=%u auto_start=%u\n&quot;</span>,</div>
<div class="line">          should_connect_to_open_ap, should_use_fast_connect, auto_start);</div>
<div class="line">  rc = wlan_ioctl_set_connection_policy(should_connect_to_open_ap, should_use_fast_connect, auto_start);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Connection policy set got %ld\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_connect (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> rl;</div>
<div class="line">  <span class="keyword">const</span> sWlanSecMap * mp;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t[2];</div>
<div class="line"></div>
<div class="line">  mp = wlanSecMapFromValue(connectParams.security_type);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;connect to ssid &#39;%s&#39; by %s using &#39;%s&#39;\n&quot;</span>,</div>
<div class="line">          connectParams.ssid, (mp ? mp-&gt;tag : <span class="stringliteral">&quot;&lt;UNDEF&gt;&quot;</span>),</div>
<div class="line">          connectParams.passphrase);</div>
<div class="line">  t[0] = <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line">  rl = wlan_connect(connectParams.security_type,</div>
<div class="line">                    connectParams.ssid, connectParams.ssid_len,</div>
<div class="line">                    NULL,</div>
<div class="line">                    connectParams.passphrase, connectParams.passphrase_len);</div>
<div class="line">  t[1] = <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;con %ld in %s\n&quot;</span>, rl, <a class="code" href="uptime_8h.html#a790fc3c41c4a8e93ec7caca7825733c1">xBSP430uptimeAsText_ni</a>(t[1]-t[0]));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_ssid = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;ssid&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[{ssid}] # Display or set AP SSID for connect&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_ssid</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_passphrase = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;passphrase&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[{passphrase}] # Display or set AP passphrase&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_wlan_ssid,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_passphrase</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_sectype = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;sectype&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[{sectype}] # Display or set AP sectype&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_wlan_passphrase,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_sectype</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_autocon = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;autocon&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[open_ap=0 [fast_conn=1 [auto_conn=1]]]&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_wlan_sectype,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_autocon</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_connect = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;connect&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# connect to specified access point using AP config&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_wlan_autocon,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_connect</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_connect</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_CONNECT */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_PROFILE - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_profile_del (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line">  <span class="keywordtype">int</span> profile = -1;</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Profiles start with number 0, somewhere at 0x430.  SSID at 0x442, PSK at 0x49a.  */</span></div>
<div class="line">  (void)<a class="code" href="group__grp__utility__cli__hci.html#ga91a46c6159bd5218814c96cbc28a60db">iBSP430cliStoreExtractedI</a>(&amp;argstr, &amp;argstr_len, &amp;profile);</div>
<div class="line">  rc = wlan_ioctl_del_profile(profile);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Del profile %d got %ld\n&quot;</span>, profile, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_profile_del = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;del&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[profile=0] # delete profile, 255 for all&quot;</span>),</div>
<div class="line">  .next = NULL,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_profile_del</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_profile = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;profile&quot;</span>,</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .child = &amp;dcmd_wlan_profile_del</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_profile</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_PROFILE */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_SMART - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_smart_aes (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * key = NULL;</div>
<div class="line">  <span class="keywordtype">size_t</span> keylen;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> keybuf[AES128_KEY_SIZE];</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (isspace((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*argstr)) {</div>
<div class="line">    ++argstr;</div>
<div class="line">  }</div>
<div class="line">  argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordflow">if</span> (*argstr) {</div>
<div class="line">    key = <a class="code" href="group__grp__utility__cli__hci.html#gabcda3dd127008a5cdcc5f40cac4e9e68">xBSP430cliNextQToken</a>(&amp;argstr, &amp;argstr_len, &amp;keylen);</div>
<div class="line">    memset(keybuf, 0, <span class="keyword">sizeof</span>(keybuf));</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(keybuf) &lt; keylen) {</div>
<div class="line">      keylen = <span class="keyword">sizeof</span>(keybuf);</div>
<div class="line">    }</div>
<div class="line">    memcpy(keybuf, key, keylen);</div>
<div class="line">    rc = aes_write_key(keybuf);</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;aes_write_key got %ld\n&quot;</span>, rc);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    rc = aes_read_key(keybuf);</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;aes_read_key got %ld\n&quot;</span>, rc);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Key:\n&quot;</span>);</div>
<div class="line">  displayMemory((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)keybuf, <span class="keyword">sizeof</span>(keybuf), 0);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_smart_process (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line"></div>
<div class="line">  rc = wlan_smart_config_process();</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;wlan_smart_config_process() got %ld\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_smart_stop (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line"></div>
<div class="line">  rc = wlan_smart_config_stop();</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;wlan_smart_config_stop() got %ld\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_smart_start (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> encrypted = 0;</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line"></div>
<div class="line">  (void)<a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;encrypted);</div>
<div class="line">  rc = wlan_smart_config_start(encrypted);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;wlan_smart_config_start(%d) got %ld\n&quot;</span>, encrypted, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_smart_aes = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;aes&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[key] # set or read AES key&quot;</span>),</div>
<div class="line">  .next = NULL,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_smart_aes</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_smart_process = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;process&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# process AES received data&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_wlan_smart_aes,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_smart_process</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_smart_stop = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;stop&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# stop smart config process&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_wlan_smart_process,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_smart_stop</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_smart_start = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;start&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[encrypted=0] # start smart config process&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_wlan_smart_stop,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_smart_start</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_smart = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;smart&quot;</span>,</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .child = &amp;dcmd_wlan_smart_start</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_smart</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_SMART */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_STATUS - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_status (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Contrary to the documentation, there are no macro constants</span></div>
<div class="line"><span class="comment">   * defined for these states */</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * status_str[] = {</div>
<div class="line">    <span class="stringliteral">&quot;disconnected&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;scanning&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;connecting&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;connected&quot;</span></div>
<div class="line">  };</div>
<div class="line">  <span class="keywordtype">long</span> rl = wlan_ioctl_statusget();</div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_CONNECT - 0)</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> sWlanSecMap * mp;</div>
<div class="line">    mp = wlanSecMapFromValue(connectParams.security_type);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;AP configuration SSID &#39;%s&#39;, passphrase &#39;%s&#39;\n&quot;</span>,</div>
<div class="line">            connectParams.ssid, connectParams.passphrase);</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;AP security type %s (%u)\n&quot;</span>, (mp ? mp-&gt;tag : <span class="stringliteral">&quot;&lt;UNDEF&gt;&quot;</span>), connectParams.security_type);</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_CONNECT */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;WLAN status %ld&quot;</span>, rl);</div>
<div class="line">  <span class="keywordflow">if</span> ((0 &lt;= rl) &amp;&amp; (rl &lt; (<span class="keyword">sizeof</span>(status_str)/<span class="keyword">sizeof</span>(*status_str)))) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;: %s&quot;</span>, status_str[rl]);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_status = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;status&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# get CC3000 status and AP config&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_status</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_status</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_STATUS */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_BROKEN - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_timeouts (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line">  <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> dhcp_s;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arp_s;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ka_s;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> inactive_s;</div>
<div class="line">  } params;</div>
<div class="line"></div>
<div class="line">  params.dhcp_s = 14400;</div>
<div class="line">  params.arp_s = 3600;</div>
<div class="line">  params.ka_s = 600000;</div>
<div class="line">  params.inactive_s = 600000;</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;*** NOTE: No evidence this function works (KA does not)\n&quot;</span>);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;DHCP timeout: %lu sec\n&quot;</span>, params.dhcp_s);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ARP timeout: %lu sec\n&quot;</span>, params.arp_s);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Keep-Alive timeout: %lu sec\n&quot;</span>, params.ka_s);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Inactive timeout: %lu sec\n&quot;</span>, params.inactive_s);</div>
<div class="line">  rc = netapp_timeout_values(&amp;params.dhcp_s, &amp;params.arp_s, &amp;params.ka_s, &amp;params.inactive_s);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Timeout set got %ld\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_timeouts = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;timeouts&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# set CC3000 timeouts&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_timeouts</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_timeouts</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_BROKEN */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_START - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_wlan_start (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> t[2];</div>
<div class="line">  t[0] = <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line">  wlan_start(0);</div>
<div class="line">  t[1] = <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;wlan_start() took %s\n&quot;</span>, <a class="code" href="uptime_8h.html#a790fc3c41c4a8e93ec7caca7825733c1">xBSP430uptimeAsText_ni</a>(t[1]-t[0]));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan_start = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;start&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# power-up CC3000&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_wlan_start</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_wlan_start</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_START */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_wlan = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;wlan&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .child = LAST_SUB_COMMAND</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_wlan</span></div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND NULL</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_SCAN - 0)</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define X_WLAN_SCAN_STATUS_AGED 0</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define X_WLAN_SCAN_STATUS_VALID 1</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define X_WLAN_SCAN_STATUS_NONE 2</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>sWLANFullScanResults {</div>
<div class="line">  uint32_t network_count;</div>
<div class="line">  uint32_t scan_status;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> isValid:1;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rssi:7;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> securityMode:2;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ssidNameLength:6;</div>
<div class="line">  uint16_t entryTime;</div>
<div class="line">  <span class="keywordtype">char</span> ssid[32];</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> bssid[6];</div>
<div class="line">} sWLANFullScanResults;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_scan_show (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">int</span> with_mem = 0;</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line">  <span class="keyword">union </span>{</div>
<div class="line">    sWLANFullScanResults structure;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> bytes[1];</div>
<div class="line">  } uresult;</div>
<div class="line">  <span class="keyword">const</span> sWLANFullScanResults * <span class="keyword">const</span> sp = &amp;uresult.structure;</div>
<div class="line"></div>
<div class="line">  (void)<a class="code" href="group__grp__utility__cli__hci.html#ga91a46c6159bd5218814c96cbc28a60db">iBSP430cliStoreExtractedI</a>(&amp;argstr, &amp;argstr_len, &amp;with_mem);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Scan results:\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;SSID                             &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;Scty  &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;BSSID             &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;RSSI &quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;Time&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    rc = wlan_ioctl_get_scan_results(0, uresult.bytes);</div>
<div class="line">    <span class="keywordflow">if</span> (0 != rc) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ERR: rc %ld\n&quot;</span>, rc);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (X_WLAN_SCAN_STATUS_NONE == sp-&gt;scan_status) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;No results\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (X_WLAN_SCAN_STATUS_AGED == sp-&gt;scan_status) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;No new results\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (! sp-&gt;isValid) {</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Invalid\n&quot;</span>);</div>
<div class="line">      <span class="keywordflow">continue</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (with_mem) {</div>
<div class="line">      displayMemory(uresult.bytes, <span class="keyword">sizeof</span>(*sp), 0);</div>
<div class="line">    }</div>
<div class="line">    { <span class="comment">/* SSID */</span></div>
<div class="line">      <span class="keyword">const</span> <span class="keywordtype">int</span> nsp = sp-&gt;ssidNameLength;</div>
<div class="line">      <span class="keywordtype">int</span> i;</div>
<div class="line">      <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(sp-&gt;ssid); ++i) {</div>
<div class="line">        <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>((i &lt; nsp) ? sp-&gt;ssid[i] : <span class="charliteral">&#39; &#39;</span>);</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39; &#39;</span>);</div>
<div class="line">    }</div>
<div class="line">    { <span class="comment">/* Security */</span></div>
<div class="line">      <span class="keyword">const</span> sWlanSecMap * mp = wlanSecMapFromValue(sp-&gt;securityMode);</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%-5s &quot;</span>, (NULL == mp) ? <span class="stringliteral">&quot;???&quot;</span> : mp-&gt;tag);</div>
<div class="line">    }</div>
<div class="line">    { <span class="comment">/* BSSI */</span></div>
<div class="line">      <span class="keywordtype">int</span> i;</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%02x&quot;</span>, sp-&gt;bssid[0]);</div>
<div class="line">      <span class="keywordflow">for</span> (i = 1; i &lt; <span class="keyword">sizeof</span>(sp-&gt;bssid); ++i) {</div>
<div class="line">        <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;:%02x&quot;</span>, sp-&gt;bssid[i]);</div>
<div class="line">      }</div>
<div class="line">      <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39; &#39;</span>); <span class="comment">/* 17 chars plus separating space */</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;% 3d  &quot;</span>, -128 + sp-&gt;rssi); <span class="comment">/* RSSI */</span></div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%-5u &quot;</span>, sp-&gt;entryTime);    <span class="comment">/* Time */</span></div>
<div class="line">    <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line">  } <span class="keywordflow">while</span> (1 &lt; sp-&gt;network_count);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_scan_start (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> rc;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> interval_ms = 1;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> delays[16];</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">  (void)<a class="code" href="group__grp__utility__cli__hci.html#gac1d3224f520dabd275954219dac876f8">iBSP430cliStoreExtractedUL</a>(&amp;argstr, &amp;argstr_len, &amp;interval_ms);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(delays)/<span class="keyword">sizeof</span>(*delays); ++i) {</div>
<div class="line">    delays[i] = 2000;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  rc = wlan_ioctl_set_scan_params(interval_ms, <span class="comment">/* Enable (1 is 10 min interval; other values are interval between active probe sweeps, in ms) */</span></div>
<div class="line">                                  100, <span class="comment">/* Min dwell per channel */</span></div>
<div class="line">                                  150, <span class="comment">/* Max dwell per channel */</span></div>
<div class="line">                                  5,  <span class="comment">/* Probes within dwell.  0 will still send one probe. */</span></div>
<div class="line">                                  0x7ff, <span class="comment">/* Channel mask: 0x7ff enables 1..11 */</span></div>
<div class="line">                                  -80,   <span class="comment">/* Default RSSI threshold.  No apparent effect changing this. */</span></div>
<div class="line">                                  0,   <span class="comment">/* SNR threshold */</span></div>
<div class="line">                                  205, <span class="comment">/* Probe TX power */</span></div>
<div class="line">                                  delays); <span class="comment">/* Timeout between scans */</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Scan start %lu ms got %ld\n&quot;</span>, interval_ms, rc);</div>
<div class="line">  <span class="keywordflow">return</span> rc;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_scan_stop (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> rc;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> delays[16];</div>
<div class="line">  <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <span class="keyword">sizeof</span>(delays)/<span class="keyword">sizeof</span>(*delays); ++i) {</div>
<div class="line">    delays[i] = 2000;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* This stops the scan within the current session, but it will</span></div>
<div class="line"><span class="comment">   * automatically restart on the next power-up. */</span></div>
<div class="line">  rc = wlan_ioctl_set_scan_params(0, 150, 150, 5, 0x1fff, -80, 0, 205, delays);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Scan stop got %ld\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">return</span> rc;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_scan_show = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;show&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot; [with_mem=0] # display scan results&quot;</span>),</div>
<div class="line">  .next = NULL,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_scan_show</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_scan_stop = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;stop&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# disable periodic scan&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_scan_show,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_scan_stop</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_scan_start = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;start&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot; [interval=1] # start periodic scan (ms)&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_scan_stop,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_scan_start</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_scan = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;scan&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .child = &amp;dcmd_scan_start</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_scan</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_SCAN */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_NVMEM - 0)</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>sNVMEMFileIds {</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fileid;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * tag;</div>
<div class="line">} sNVMEMFileIds;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> sNVMEMFileIds nvmemFiles[] = {</div>
<div class="line">  { NVMEM_NVS_FILEID, 512, <span class="stringliteral">&quot;NVS&quot;</span>, },</div>
<div class="line">  { NVMEM_NVS_SHADOW_FILEID, 512, <span class="stringliteral">&quot;NVS (shadow)&quot;</span> },</div>
<div class="line">  { NVMEM_WLAN_CONFIG_FILEID, 4096, <span class="stringliteral">&quot;WLAN Config&quot;</span>, },</div>
<div class="line">  { NVMEM_WLAN_CONFIG_SHADOW_FILEID, 4096, <span class="stringliteral">&quot;WLAN Config (shadow)&quot;</span> },</div>
<div class="line">  { NVMEM_WLAN_DRIVER_SP_FILEID, 0, <span class="stringliteral">&quot;WLAN Driver SP&quot;</span> },</div>
<div class="line">  { NVMEM_WLAN_FW_SP_FILEID, 0, <span class="stringliteral">&quot;WLAN Firmware SP&quot;</span> },</div>
<div class="line">  { NVMEM_MAC_FILEID, 16, <span class="stringliteral">&quot;MAC address&quot;</span> },</div>
<div class="line">  { NVMEM_FRONTEND_VARS_FILEID, 0, <span class="stringliteral">&quot;Front End Vars ??&quot;</span> },</div>
<div class="line">  { NVMEM_IP_CONFIG_FILEID, 64, <span class="stringliteral">&quot;IP Config&quot;</span> },</div>
<div class="line">  { NVMEM_IP_CONFIG_SHADOW_FILEID, 64, <span class="stringliteral">&quot;IP Config (shadow)&quot;</span> },</div>
<div class="line">  { NVMEM_BOOTLOADER_SP_FILEID, 0, <span class="stringliteral">&quot;Bootloader SP&quot;</span> },</div>
<div class="line">  { NVMEM_RM_FILEID, 0, <span class="stringliteral">&quot;RM ??&quot;</span> },</div>
<div class="line">  { NVMEM_AES128_KEY_FILEID, 0, <span class="stringliteral">&quot;AES128 Key ??&quot;</span> },</div>
<div class="line">  { NVMEM_SHARED_MEM_FILEID, 0, <span class="stringliteral">&quot;Shared Memory ??&quot;</span> },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_nvmem_dir (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> sNVMEMFileIds * fp = nvmemFiles;</div>
<div class="line">  <span class="keyword">const</span> sNVMEMFileIds * <span class="keyword">const</span> fpe = fp + <span class="keyword">sizeof</span>(nvmemFiles) / <span class="keyword">sizeof</span>(*nvmemFiles);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%u NVMEM files with %u documented:\n&quot;</span>, NVMEM_MAX_ENTRY, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(fpe-fp));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ID  Size  Description\n&quot;</span>);</div>
<div class="line">  <span class="keywordflow">while</span> (fp &lt; fpe) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%2d  %4d  %s\n&quot;</span>, fp-&gt;fileid, fp-&gt;size, fp-&gt;tag);</div>
<div class="line">    ++fp;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_nvmem_dir = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;dir&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# describe NVMEM sections&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_nvmem_dir</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_nvmem_dir</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_nvmem_create (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fileid = NVMEM_AES128_KEY_FILEID;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length = AES128_KEY_SIZE;</div>
<div class="line">  <span class="keywordtype">long</span> rc;</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"></div>
<div class="line">  rv = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;fileid);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rv) {</div>
<div class="line">    rv = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;length);</div>
<div class="line">  }</div>
<div class="line">  rc = nvmem_create_entry(fileid, length);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;nvmem_create_entry(%u, %u) got %ld\n&quot;</span>, fileid, length, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_nvmem_create = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;create&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[fileid=12 [length=16]] # create a new NVMEM section&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_nvmem_create</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_nvmem_create</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_NVMEM_SP - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_nvmem_sp (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> patch_version[2];</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> rv;</div>
<div class="line"></div>
<div class="line">  memset(patch_version, -1, <span class="keyword">sizeof</span>(patch_version));</div>
<div class="line">  rv = nvmem_read_sp_version(patch_version);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;sp ret %u: %u.%u\n&quot;</span>, rv, patch_version[0], patch_version[1]);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Host driver %u\n&quot;</span>, DRIVER_VERSION_NUMBER);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_nvmem_sp = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;sp&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# read firmware service pack level&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_nvmem_sp</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_nvmem_sp</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_NVMEM_SP */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_NVMEM_READ - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_nvmem_read (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> rc;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fileid = 0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len = 128;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ofs = 0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> data[16];       <span class="comment">/* Page size? */</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> end_read;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ui;</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nb;</div>
<div class="line"></div>
<div class="line">  rc = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;ui);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    fileid = ui;</div>
<div class="line">    rc = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;ui);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    len = ui;</div>
<div class="line">    rc = <a class="code" href="group__grp__utility__cli__hci.html#gad6c6edd09983b8360f0a44d47ed32ec6">iBSP430cliStoreExtractedUI</a>(&amp;argstr, &amp;argstr_len, &amp;ui);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    ofs = ui;</div>
<div class="line">  }</div>
<div class="line">  end_read = ofs + len;</div>
<div class="line">  rc = 0;</div>
<div class="line">  <span class="keywordflow">while</span> ((0 == rc) &amp;&amp; (ofs &lt; end_read)) {</div>
<div class="line">    nb = (end_read - ofs);</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(data) &lt; nb) {</div>
<div class="line">      nb = <span class="keyword">sizeof</span>(data);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* NB: API documentation is wrong, return is 0 if successful, 4 if</span></div>
<div class="line"><span class="comment">     * offset too large, 3 unknown error. */</span></div>
<div class="line">    rc = nvmem_read(fileid, nb, ofs, data);</div>
<div class="line">    <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">      displayMemory(data, nb, ofs);</div>
<div class="line">      ofs += nb;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (0 != rc) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\nERR: Read returned %u for %u bytes at %u of fileid %u\n&quot;</span>,</div>
<div class="line">            rc, nb, ofs, fileid);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_nvmem_read = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;read&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;fileid [len(=128) [ofs(=0)]] # read block from nvmem file&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_nvmem_read</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_nvmem_read</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_NVMEM_READ */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_NVMEM_MAC - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_nvmem_mac (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> rc;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mac[6];</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Could extend this to parse &quot;set {addr}&quot; if you wanted. */</span></div>
<div class="line">  rc = nvmem_get_mac_address(mac);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == rc) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;nvmem mac is %02x.%02x.%02x.%02x.%02x.%02x\n&quot;</span>,</div>
<div class="line">            mac[0], mac[1], mac[2], mac[3], mac[4], mac[5]);</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ERR: nvmem mac read got %u\n&quot;</span>, rc);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_nvmem_mac = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;mac&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# get mac address&quot;</span>),</div>
<div class="line">  .next = LAST_SUB_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_nvmem_mac</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND &amp;dcmd_nvmem_mac</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_NVMEM_MAC */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_nvmem = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;nvmem&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .child = LAST_SUB_COMMAND</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_nvmem</span></div>
<div class="line"><span class="preprocessor">#undef LAST_SUB_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_SUB_COMMAND NULL</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_NVMEM */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if ! (BSP430_MODULE_FLASH - 0)</span></div>
<div class="line"><span class="comment">/* No support for this on FRAM boards yet */</span></div>
<div class="line"><span class="preprocessor">#undef CMD_INFO</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_INFO - 0)</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> sConnectParams * <span class="keyword">const</span> infoConnectParams = (sConnectParams *)__infob;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_info_load (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">if</span> (MAGIC_CONNECT_PARAMS != infoConnectParams-&gt;magic) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;ERR: Stored connection params invalid\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#if (CMD_WLAN_CONNECT - 0)</span></div>
<div class="line">  connectParams = *infoConnectParams;</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_WLAN_CONNECT */</span><span class="preprocessor"></span></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_info_erase_ni (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Erasing stored params at %p...&quot;</span>, infoConnectParams);</div>
<div class="line">  rv = <a class="code" href="flash_8h.html#a94c76cef12d30a8fb476cb7664338285">iBSP430flashEraseSegment_ni</a>(infoConnectParams);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%d\n&quot;</span>, rv);</div>
<div class="line">  <span class="keywordflow">return</span> rv;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_info_erase (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    rv = cmd_info_erase_ni();</div>
<div class="line">  } <span class="keywordflow">while</span> (0);</div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <span class="keywordflow">return</span> rv;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_info_store (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line">  <span class="keywordflow">do</span> {</div>
<div class="line">    rv = cmd_info_erase_ni();</div>
<div class="line">    <span class="keywordflow">if</span> (0 == rv) {</div>
<div class="line">      connectParams.magic = MAGIC_CONNECT_PARAMS;</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Copying current configuration...&quot;</span>);</div>
<div class="line">      rv = <a class="code" href="flash_8h.html#ae8561ad078b62fd3ceadabbe69421d5a">iBSP430flashWriteData_ni</a>(infoConnectParams, &amp;connectParams, <span class="keyword">sizeof</span>(connectParams));</div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%d\n&quot;</span>, rv);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">while</span> (0);</div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <span class="keywordflow">return</span> rv;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_info_dump (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Configuration memory:\n&quot;</span>);</div>
<div class="line">  displayMemory((<span class="keyword">const</span> uint8_t *)infoConnectParams, __info_segment_size, (uintptr_t)infoConnectParams);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_info_dump = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;dump&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# display INFO_B contents&quot;</span>),</div>
<div class="line">  .next = NULL,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_info_dump</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_info_store = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;store&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# store wlan AP params in INFO_B&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_info_dump,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_info_store</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_info_erase = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;erase&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# erase INFO_B&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_info_store,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_info_erase</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_info_load = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;load&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;# load wlan AP params from INFO_B&quot;</span>),</div>
<div class="line">  .next = &amp;dcmd_info_erase,</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#a896e8594759400c197809d7e346eabd8">handler</a> = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_info_load</div>
<div class="line">};</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_info = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;info&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .child = &amp;dcmd_info_load</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_info</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_INFO */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_mdns (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> argstr_len = strlen(argstr);</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * name = <span class="stringliteral">&quot;CC3000&quot;</span>;</div>
<div class="line">  <span class="keywordtype">size_t</span> name_len;</div>
<div class="line">  <span class="keywordtype">int</span> rc;</div>
<div class="line"></div>
<div class="line">  name = <a class="code" href="group__grp__utility__cli__hci.html#gabcda3dd127008a5cdcc5f40cac4e9e68">xBSP430cliNextQToken</a>(&amp;argstr, &amp;argstr_len, &amp;name_len);</div>
<div class="line">  <span class="keywordflow">if</span> (0 == name_len) {</div>
<div class="line">    rc = mdnsAdvertiser(0, <span class="stringliteral">&quot;CC3000&quot;</span>, strlen(<span class="stringliteral">&quot;CC3000&quot;</span>));</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Will advertize: &#39;&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; name_len; ++i) {</div>
<div class="line">      <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(name[i]);</div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;&#39;\n&quot;</span>);</div>
<div class="line">    rc = mdnsAdvertiser(1, (<span class="keywordtype">char</span> *)name, name_len);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;mdnsAdvertiser got %d\n&quot;</span>, rc);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_mdns = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;mdns&quot;</span>,</div>
<div class="line">  .help = HELP_STRING(<span class="stringliteral">&quot;[name] # enable/disable mDNS&quot;</span>),</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_mdns</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_mdns</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_uptime (<span class="keyword">const</span> <span class="keywordtype">char</span> * argstr)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="core_8h.html#aa45390f99fe6b993083301d3613de4a3">BSP430_CORE_SAVED_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> now_utt;</div>
<div class="line">  <span class="keywordtype">char</span> timebuf[<a class="code" href="uptime_8h.html#ae47d677ac9443e2e26608ef5278f1a6d">BSP430_UPTIME_AS_TEXT_LENGTH</a>];</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#ac381d1a1ade729f63011e7e4db511f61">BSP430_CORE_DISABLE_INTERRUPT</a>();</div>
<div class="line">  now_utt = <a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>();</div>
<div class="line">  <a class="code" href="core_8h.html#ab2a0adfa112adbcaf1f834165fee15d3">BSP430_CORE_RESTORE_INTERRUPT_STATE</a>(istate);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Time: %s\n&quot;</span>, <a class="code" href="uptime_8h.html#a1cb1310c769f028347010502456fb918">xBSP430uptimeAsText</a>(now_utt, timebuf));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Last Event %lx: %s\n&quot;</span>, lastEventType, <a class="code" href="uptime_8h.html#a1cb1310c769f028347010502456fb918">xBSP430uptimeAsText</a>(lastCallback_utt, timebuf));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Last KA: %s\n&quot;</span>, <a class="code" href="uptime_8h.html#a1cb1310c769f028347010502456fb918">xBSP430uptimeAsText</a>(lastKeepAlive_utt, timebuf));</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_uptime = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;uptime&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = <a class="code" href="cli_8h.html#a3262960abdfc1bbfa7143bb79e9396ff">iBSP430cliHandlerSimple</a>,</div>
<div class="line">  .param.simple_handler = cmd_uptime</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_uptime</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_test (<a class="code" href="structsBSP430cliCommandLink.html">sBSP430cliCommandLink</a> * chain,</div>
<div class="line">          <span class="keywordtype">void</span> * param,</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">char</span> * command,</div>
<div class="line">          <span class="keywordtype">size_t</span> command_len)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_test = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;test&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = cmd_test</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_test</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_HELP - 0)</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">cmd_help (<a class="code" href="structsBSP430cliCommandLink.html">sBSP430cliCommandLink</a> * chain,</div>
<div class="line">          <span class="keywordtype">void</span> * param,</div>
<div class="line">          <span class="keyword">const</span> <span class="keywordtype">char</span> * command,</div>
<div class="line">          <span class="keywordtype">size_t</span> command_len)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="group__grp__utility__cli__cli.html#ga2c3a36a00ea6f676cf2006859364d45a">vBSP430cliConsoleDisplayHelp</a>(chain-&gt;<a class="code" href="structsBSP430cliCommandLink.html#ad4701a7a6b809d746683cb5b0a6f2018">cmd</a>);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <a class="code" href="structsBSP430cliCommand.html">sBSP430cliCommand</a> dcmd_help = {</div>
<div class="line">  .<a class="code" href="structsBSP430cliCommand.html#afc4749b003e26d829a7d9b92698edfd4">key</a> = <span class="stringliteral">&quot;help&quot;</span>,</div>
<div class="line">  .next = LAST_COMMAND,</div>
<div class="line">  .handler = cmd_help</div>
<div class="line">};</div>
<div class="line"><span class="preprocessor">#undef LAST_COMMAND</span></div>
<div class="line"><span class="preprocessor">#define LAST_COMMAND &amp;dcmd_help</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* CMD_HELP */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> rv;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span> * command;</div>
<div class="line">  <span class="keywordtype">int</span> flags;</div>
<div class="line"><span class="preprocessor">#if (BSP430_MODULE_SYS - 0)</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> reset_causes = 0;</div>
<div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> reset_flags = 0;</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_MODULE_SYS */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (BSP430_MODULE_SYS - 0)</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sysrstiv;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Record all the reset causes */</span></div>
<div class="line">    <span class="keywordflow">while</span> (0 != ((sysrstiv = <a class="code" href="sys_8h.html#a49bc446977f788990eaf4de3e3b3d234">uiBSP430sysSYSRSTGenerator_ni</a>(&amp;reset_flags)))) {</div>
<div class="line">      reset_causes |= 1UL &lt;&lt; (sysrstiv / 2);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef BSP430_PMM_ENTER_LPMXp5_NI</span></div>
<div class="line">    <span class="comment">/* If we woke from LPMx.5, we need to clear the lock in PM5CTL0.</span></div>
<div class="line"><span class="comment">     * We&#39;ll do it early, since we&#39;re not really interested in</span></div>
<div class="line"><span class="comment">     * retaining the current IFG settings. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (reset_flags &amp; BSP430_SYS_FLAG_SYSRST_LPM5WU) {</div>
<div class="line">      PMMCTL0_H = PMMPW_H;</div>
<div class="line">      PM5CTL0 = 0;</div>
<div class="line">      PMMCTL0_H = 0;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PMM_ENTER_LPMXp5_NI */</span><span class="preprocessor"></span></div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_MODULE_SYS */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="platform_8h.html#a616515ce5e0f7635ca36a815841d2a21">vBSP430platformInitialize_ni</a>();</div>
<div class="line">  (void)<a class="code" href="console_8h.html#a91f5f68fa2ee29ca39bf9a23ea98cbe1">iBSP430consoleInitialize</a>();</div>
<div class="line">  <a class="code" href="cli_8h.html#a0a5b3cee7e2d9002d5d301b36c814d55">vBSP430cliSetDiagnosticFunction</a>(<a class="code" href="group__grp__utility__cli__cli.html#ga30922f40d6b2702628bb88d9e0069caf">iBSP430cliConsoleDiagnostic</a>);</div>
<div class="line">  <a class="code" href="core_8h.html#a3124959aa09ef7d745fb63c9ff5ee897">BSP430_CORE_DELAY_CYCLES</a>(<a class="code" href="clock_8h.html#a6ffd3f4fab35b64d0e8ff8d3179d69d9">BSP430_CLOCK_NOMINAL_MCLK_HZ</a> / 2);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\ncc3000 &quot;</span> __DATE__ <span class="stringliteral">&quot; &quot;</span> __TIME__ <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (BSP430_MODULE_SYS - 0)</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;System reset bitmask %lx; causes:\n&quot;</span>, reset_causes);</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">int</span> bit = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (bit &lt; (8 * <span class="keyword">sizeof</span>(reset_causes))) {</div>
<div class="line">      <span class="keywordflow">if</span> (reset_causes &amp; (1UL &lt;&lt; bit)) {</div>
<div class="line">        <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\t%s\n&quot;</span>, <a class="code" href="sys_8h.html#a2012d634fbc0045a010a2158b37248f2">xBSP430sysSYSRSTIVDescription</a>(2*bit));</div>
<div class="line">      }</div>
<div class="line">      ++bit;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot;System reset included:&quot;</span>);</div>
<div class="line">  <span class="keywordflow">if</span> (reset_flags) {</div>
<div class="line">    <span class="keywordflow">if</span> (reset_flags &amp; BSP430_SYS_FLAG_SYSRST_BOR) {</div>
<div class="line">      <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot; BOR&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (reset_flags &amp; BSP430_SYS_FLAG_SYSRST_LPM5WU) {</div>
<div class="line">      <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot; LPM5WU&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (reset_flags &amp; BSP430_SYS_FLAG_SYSRST_POR) {</div>
<div class="line">      <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot; POR&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (reset_flags &amp; BSP430_SYS_FLAG_SYSRST_PUC) {</div>
<div class="line">      <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot; PUC&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    <a class="code" href="console_8h.html#ac4ebbf60b8d0840b3039203c47f61c86">cputtext</a>(<span class="stringliteral">&quot; no data&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_MODULE_SYS */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;PWR_EN at %s.%u\n&quot;</span>, <a class="code" href="port_8h.html#a78a791b05b428f3aa2bf5ff09e907200">xBSP430portName</a>(BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE), <a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(BSP430_RF_CC3000_PWR_EN_PORT_BIT));</div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;No PWR_EN control.\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_RF_CC3000_PWR_EN_PORT_PERIPH_HANDLE */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;SPI_IRQ HAL at %s.%u\n&quot;</span>, <a class="code" href="port_8h.html#a78a791b05b428f3aa2bf5ff09e907200">xBSP430portName</a>(BSP430_RF_CC3000_IRQn_PORT_PERIPH_HANDLE), <a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(BSP430_RF_CC3000_IRQn_PORT_BIT));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;CSn HAL at %s.%u\n&quot;</span>, <a class="code" href="port_8h.html#a78a791b05b428f3aa2bf5ff09e907200">xBSP430portName</a>(BSP430_RF_CC3000_CSn_PORT_PERIPH_HANDLE), <a class="code" href="port_8h.html#aa9b72a778f0f690c08bba27871c4d374">iBSP430portBitPosition</a>(BSP430_RF_CC3000_CSn_PORT_BIT));</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;SPI is %s\n&quot;</span>, <a class="code" href="serial_8h.html#a7f2e6f39abd1faca343663917e34840a">xBSP430serialName</a>(BSP430_RF_CC3000_SPI_PERIPH_HANDLE));</div>
<div class="line"><span class="preprocessor">#if BSP430_PLATFORM_PERIPHERAL_HELP</span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;SPI Pins: %s\n&quot;</span>, <a class="code" href="platform_8h.html#ad5df0a450196592bc395c5efe89a6fb3">xBSP430platformPeripheralHelp</a>(BSP430_RF_CC3000_SPI_PERIPH_HANDLE, <a class="code" href="periph_8h.html#a5a28880814f93f755ea189df4e2d1900">BSP430_PERIPHCFG_SERIAL_SPI3</a>));</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_PERIPHERAL_HELP */</span><span class="preprocessor"></span></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;CC3000 host driver: %u\n&quot;</span>, DRIVER_VERSION_NUMBER);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(__DATE__ <span class="stringliteral">&quot; &quot;</span> __TIME__ <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* Initialization can be done with interrupts disabled, since the</span></div>
<div class="line"><span class="comment">   * function does nothing but store callbacks. */</span></div>
<div class="line">  rv = <a class="code" href="cc3000spi_8h.html#a18c48988f94c6984548d28e802377344">iBSP430cc3000spiInitialize</a>(wlan_cb, NULL, NULL, NULL);</div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;%s Initialize returned %d\n&quot;</span>, <a class="code" href="uptime_8h.html#a790fc3c41c4a8e93ec7caca7825733c1">xBSP430uptimeAsText_ni</a>(<a class="code" href="uptime_8h.html#ab4b2fa8646bfd0856d6a9b095db30e93">ulBSP430uptime_ni</a>()), rv);</div>
<div class="line">  <span class="keywordflow">if</span> (0 &gt; rv) {</div>
<div class="line">    <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Aborting due to failure to initialized\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  commandSet = LAST_COMMAND;</div>
<div class="line">  command = NULL;</div>
<div class="line">  flags = <a class="code" href="group__grp__utility__cli__cli.html#ggabf197215e696298dd3a9690ef10a69deaf4a31c8e1956488e1ff37d22d55936b3">eBSP430cliConsole_REPAINT</a>;</div>
<div class="line"></div>
<div class="line">  <a class="code" href="core_8h.html#a954f39fe5652611f5a20f74289b0cfbf">BSP430_CORE_ENABLE_INTERRUPT</a>();</div>
<div class="line"></div>
<div class="line">  <span class="comment">/* wlan_start() MUST be invoked with interrupts enabled. */</span></div>
<div class="line">  wlan_start(0);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\nAnd wlan has been started.\n&quot;</span>);</div>
<div class="line">  (void)displayMemory;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if (CMD_INFO - 0)</span></div>
<div class="line">  <span class="keywordflow">if</span> (0 == cmd_info_load(<span class="stringliteral">&quot;&quot;</span>)) {</div>
<div class="line">    cmd_wlan_status(<span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">while</span> (1) {</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_DO_COMPLETION) {</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_DO_COMPLETION;</div>
<div class="line">      flags |= <a class="code" href="group__grp__utility__cli__completion.html#ga5086d946e412fa4e9928819d664fc2cc">iBSP430cliConsoleBufferCompletion</a>(commandSet, &amp;command);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_READY) {</div>
<div class="line">      <span class="keywordtype">int</span> rv;</div>
<div class="line"></div>
<div class="line">      rv = <a class="code" href="cli_8h.html#adcdb159a40c5cb6737cf97b497b58a55">iBSP430cliExecuteCommand</a>(commandSet, 0, command);</div>
<div class="line">      <span class="keywordflow">if</span> (0 != rv) {</div>
<div class="line">        <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;Command execution returned %d\n&quot;</span>, rv);</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">/* Ensure prompt is rewritten, but not the command we just</span></div>
<div class="line"><span class="comment">       * ran */</span></div>
<div class="line">      flags |= <a class="code" href="group__grp__utility__cli__cli.html#ggabf197215e696298dd3a9690ef10a69deaf4a31c8e1956488e1ff37d22d55936b3">eBSP430cliConsole_REPAINT</a>;</div>
<div class="line">      command = NULL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_REPAINT) {</div>
<div class="line">      <span class="comment">/* Draw the prompt along with whatever&#39;s left in the command buffer */</span></div>
<div class="line">      <a class="code" href="console_8h.html#a20188454c5c787938220b7bcf3179869">cprintf</a>(<span class="stringliteral">&quot;\r&gt; %s&quot;</span>, command ? command : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_REPAINT;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_REPAINT_BEL) {</div>
<div class="line">      <a class="code" href="console_8h.html#aa0572fcebf5d24edff00fc60c4563681">cputchar</a>(<span class="charliteral">&#39;\a&#39;</span>);</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_REPAINT_BEL;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (flags &amp; eBSP430cliConsole_READY) {</div>
<div class="line">      <span class="comment">/* Clear the command we just completed */</span></div>
<div class="line">      <a class="code" href="group__grp__utility__cli__cli.html#ga15ac053830a35c1b1410fda48c0e7e3a">vBSP430cliConsoleBufferClear</a>();</div>
<div class="line">      flags &amp;= ~eBSP430cliConsole_READY;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">      <span class="comment">/* Discard any pending escape sequence */</span></div>
<div class="line">      flags = <a class="code" href="cli_8h.html#ab53c18df933fd6696f8d3e92795295f8">iBSP430cliConsoleBufferConsumeEscape</a>(flags);</div>
<div class="line">      <span class="comment">/* If no operations are pending, see if there is pending input. */</span></div>
<div class="line">      <span class="keywordflow">if</span> (0 == flags) {</div>
<div class="line">        flags = <a class="code" href="group__grp__utility__cli__cli.html#gaf192635722fef70abb4583a1c52a4e7a">iBSP430cliConsoleBufferProcessInput</a>();</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">/* If still no operations pending wait for something to</span></div>
<div class="line"><span class="comment">       * happen. */</span></div>
<div class="line">      <span class="keywordflow">if</span> (0 == flags) {</div>
<div class="line">        <a class="code" href="core_8h.html#a1b153003ca93d41bd574dcd4790feb6d">BSP430_CORE_LPM_ENTER</a>(<a class="code" href="msp430_8h.html#a8af1e5b3633693d9439d284100183004">LPM2_bits</a>);</div>
<div class="line">      }</div>
<div class="line">    } <span class="keywordflow">while</span> (! flags);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Got something to do; get the command contents in place so</span></div>
<div class="line"><span class="comment">     * we can update the screen. */</span></div>
<div class="line">    command = <a class="code" href="group__grp__utility__cli__cli.html#ga634626363e043b2a1efa7fb7b657ebe4">xBSP430cliConsoleBuffer</a>();</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="ex_rf_cc3000_config"></a>
bsp430_config.h</h1>
<div class="fragment"><div class="line"><span class="comment">/* Use a crystal if one is installed.  Much more accurate timing</span></div>
<div class="line"><span class="comment"> * results. */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_PLATFORM_BOOT_CONFIGURE_LFXT1 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Application does output: support spin-for-jumper */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_PLATFORM_SPIN_FOR_JUMPER 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Support console output */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_CONSOLE 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Enable an 8-character rx buffer for the console */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_CONSOLE_RX_BUFFER_SIZE 8</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Enable an 80-character command buffer */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_CLI_CONSOLE_BUFFER_SIZE 80</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Enable completion */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_CLI_COMMAND_COMPLETION 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Monitor uptime and provide generic ACLK-driven timer */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_UPTIME 1</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Support for CC30000 BoosterPack.  This conflicts with RFEM use. */</span></div>
<div class="line"><span class="preprocessor">#ifndef configBSP430_RF_CC3000BOOST</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_RF_CC3000BOOST 0</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* configBSP430_RF_CC3000BOOST */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if ! (configBSP430_RF_CC3000BOOST - 0)</span></div>
<div class="line"><span class="comment">/* Request RFEM interface resources specific to the CC3000EM.  NB:</span></div>
<div class="line"><span class="comment"> * CCEM maps SPI_IRQ to P6.5 on EXP430F5529LP; since that port is not</span></div>
<div class="line"><span class="comment"> * interrupt-enabled the CC3000 can&#39;t be used on that platform. */</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_RFEM_CCEM 1</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_RFEM 1</span></div>
<div class="line"><span class="preprocessor">#define configBSP430_RF_CC3000EM 1</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* RFEM */</span><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Get platform defaults */</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="bsp430__config_8h.html">bsp430/platform/bsp430_config.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* We use HAL for CSn, perhaps because it&#39;s a generic interface to the</span></div>
<div class="line"><span class="comment"> * DIR and OUT registers regardless of IE or non-IE register</span></div>
<div class="line"><span class="comment"> * layout. */</span></div>
<div class="line"><span class="preprocessor">#define BSP430_WANT_CONFIG_HAL 1</span></div>
<div class="line"><span class="preprocessor">#define BSP430_WANT_PERIPH_CPPID BSP430_RF_CC3000_CSn_PORT_PERIPH_CPPID</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="want___8h.html">bsp430/periph/want_.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#undef BSP430_WANT_CONFIG_HAL</span></div>
</div><!-- fragment --><h1><a class="anchor" id="ex_rf_cc3000_make"></a>
Makefile</h1>
<div class="fragment"><div class="line">PLATFORM ?= exp430f5438</div>
<div class="line">TEST_PLATFORMS=exp430f5438 trxeb</div>
<div class="line">MODULES=$(MODULES_PLATFORM)</div>
<div class="line">MODULES += $(MODULES_UPTIME)</div>
<div class="line">MODULES += $(MODULES_CONSOLE)</div>
<div class="line">MODULES += periph/port</div>
<div class="line">MODULES += periph/sys</div>
<div class="line">MODULES += periph/flash</div>
<div class="line">MODULES += utility/cli</div>
<div class="line"></div>
<div class="line"># Set <span class="keyword">this</span> to where you installed the cc3000 headers and library</div>
<div class="line">CC3000_ROOT ?= /usr/local/msp430-cc3000</div>
<div class="line"></div>
<div class="line"># Tell BSP430<span class="stringliteral">&#39;s build infrastructure about the library.</span></div>
<div class="line"><span class="stringliteral">AUX_CPPFLAGS=-I$(CC3000_ROOT)/include</span></div>
<div class="line"><span class="stringliteral">AUX_LDFLAGS=-L$(CC3000_ROOT)/lib</span></div>
<div class="line"><span class="stringliteral">AUX_LDLIBS=-lcc3000</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># Use CC3000BOOST booster pack</span></div>
<div class="line"><span class="stringliteral">ifdef CC3000BOOST</span></div>
<div class="line"><span class="stringliteral">AUX_CPPFLAGS+=-DconfigBSP430_RF_CC3000BOOST=1</span></div>
<div class="line"><span class="stringliteral">endif # CC3000BOOST</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral"># EXP430G2 has too little memory</span></div>
<div class="line"><span class="stringliteral">ifeq ($(PLATFORM),exp430g2)</span></div>
<div class="line"><span class="stringliteral">AUX_CPPFLAGS+=-DBSP430_CC3000SPI_TX_BUFFER_SIZE=8</span></div>
<div class="line"><span class="stringliteral">AUX_CPPFLAGS+=-DBSP430_CC3000SPI_RX_BUFFER_SIZE=8</span></div>
<div class="line"><span class="stringliteral">endif # exp430g2</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">SRC=cc3000spi.c main.c</span></div>
<div class="line"><span class="stringliteral">include $(BSP430_ROOT)/examples/Makefile.common</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Mar 1 2014 16:30:48 for BSP430 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
