<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>BSP430: BSP430 Coding Style</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">BSP430
   &#160;<span id="projectnumber">20130325</span>
   </div>
   <div id="projectbrief">Board Support Package for MSP430 microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BSP430 Coding Style </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#coding_style">Indentation and Syntactic Style</a></li>
<li class="level1"><a href="#coding_naming">Identifiers and Naming Conventions</a></li>
<li class="level1"><a href="#coding_types">Type Selection</a></li>
<li class="level1"><a href="#coding_misc">Miscellaneous</a><ul><li class="level2"><a href="#coding_misc_yoda">Comparison Operands</a></li>
<li class="level2"><a href="#coding_misc_rv">Function Return Values</a></li>
<li class="level2"><a href="#coding_misc_incl">Include Files</a></li>
<li class="level2"><a href="#coding_misc_cpp">Preprocessor Feature Tests</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>The coding style for BSP430 is primarily the one the author converged to over the last twenty-five years, but has a few lingering influences from FreeRTOS.</p>
<h1><a class="anchor" id="coding_style"></a>
Indentation and Syntactic Style</h1>
<p>BSP430's coding style may be obtained using the following Emacs <a href="http://cc-mode.sourceforge.net/">ccmode</a> style:</p>
<div class="fragment"><div class="line">(c-add-style <span class="stringliteral">&quot;pab&quot;</span></div>
<div class="line">         <span class="stringliteral">&#39;(&quot;gnu&quot;</span></div>
<div class="line"><span class="stringliteral">           (indent-tabs-mode . nil) ; No tabs in the source</span></div>
<div class="line"><span class="stringliteral">           (c-offsets-alist</span></div>
<div class="line"><span class="stringliteral">        (case-label . 2)    ; Indent the case labels</span></div>
<div class="line"><span class="stringliteral">        )))</span></div>
</div><!-- fragment --><p>An acceptably close approximation can be had using the following <a href="http://astyle.sourceforge.net/">Artistic Style (astyle)</a> command line:</p>
<div class="fragment"><div class="line">astyle \</div>
<div class="line">  --options=none \</div>
<div class="line">  --style=1tbs \</div>
<div class="line">  --indent=spaces=2 \</div>
<div class="line">  --indent-switches \</div>
<div class="line">  --pad-header \</div>
<div class="line">  --max-instatement-indent=60 \</div>
<div class="line">  -r \</div>
<div class="line">    <span class="stringliteral">&#39;*.c&#39;</span> \</div>
<div class="line">    <span class="stringliteral">&#39;*.h&#39;</span> \</div>
<div class="line">    <span class="stringliteral">&#39;*.inc&#39;</span></div>
</div><!-- fragment --><h1><a class="anchor" id="coding_naming"></a>
Identifiers and Naming Conventions</h1>
<p>Care is taken in BSP430 to conform to the rules for C regarding global identifiers; in particular, underscores may not appear at the start of an identifier, and certain suffixes like <code>_t</code> are reserved.</p>
<ul>
<li>All global symbols and macros encode that they are part of BSP430 by beginning with <code>BSP430</code> with or without prefix characters that indicate type information. The next section of the identifier encodes information about the BSP430 module to which it belongs.</li>
</ul>
<ul>
<li>Macros are upper-case, underscore separated. An exception is made for configuration macros which have a prefixed lower-case <code>config</code>.</li>
</ul>
<ul>
<li>Function names are intercapped. An initial letter indicates the return type: <code>i</code> is used for <code>int</code>, <code>ul</code> for <code>unsigned long</code>, <code>v</code> for <code>void</code>, and <code>h</code> for a <a class="el" href="layer.html#HAL">HAL</a> handle. The letter <code>x</code> is used as a prefix for more complex types, such as <code>const char *</code>.</li>
</ul>
<ul>
<li>Type names (tags and typedefs) are intercapped. <code>struct</code>, <code>union</code>, and <code>enum</code> types have typedef aliases that use the tag as the type name. An initial letter distinguishes the "type" of type: <code>s</code> is a <code>struct</code>, <code>u</code> is a <code>union</code>, <code>e</code> is an <code>enum</code>. <code>h</code> indicates a handle for (pointer to) a <a class="el" href="layer.html#HAL">HAL</a> structure type; for example <a class="el" href="serial___8h.html#a31185ece51d6a343bb1f1c6f44fa8bcb">hBSP430halSERIAL</a> is a typedef for a pointer to <a class="el" href="structsBSP430halSERIAL.html">sBSP430halSERIAL</a>. <code>t</code> is used for any typedef for a normal type, such as <a class="el" href="periph_8h.html#a6a1c6c4a24d03d6306bf32f8dbde05a9">tBSP430periphHandle</a>.</li>
</ul>
<ul>
<li>Enumeration values are intercapped and begin with <code>e</code>.</li>
</ul>
<ul>
<li>A concept of "protected" is indicated by a single trailing underscore. Generally this is used in macro parameters and for static storage class variables that should not be referenced outside the implementation.</li>
</ul>
<ul>
<li>The extremely rare global variables follow the general convention of function names. Most of these variables are marked as protected.</li>
</ul>
<ul>
<li>Function parameters, structure/union member tags, local variables, and and file static variables should be lower case, underscore separated. These identifiers do not encode type information.</li>
</ul>
<ul>
<li>Where a function or value has an associated physical unit that is required for correct interpretation of the value, that should be expressed as an underscore-separated suffix consistent with the <a href="http://unitsofmeasure.org/">Unified Code for Units of Measure</a>. As an example, all BSP430 frequency values are annotated with the suffix <code>_Hz</code>.</li>
</ul>
<ul>
<li>Where a function, function macro, or structure tag must be manipulated with interrupts disabled, it ends with a suffix <code>_ni</code> (<code>_NI</code> for macros).</li>
</ul>
<h1><a class="anchor" id="coding_types"></a>
Type Selection</h1>
<p>Except where a data type is used as part of an interface to an external system or to reflect a specific intent, native types are used.</p>
<ul>
<li><code>int</code> is the native type. Anybody using an MSP430 should know that this is a 16-bit value.</li>
</ul>
<ul>
<li><code>unsigned int</code> is the type for any 16-bit peripheral registers.</li>
</ul>
<ul>
<li><code>unsigned char</code> is the type for any 8-bit peripheral registers.</li>
</ul>
<ul>
<li>ASCII text characters and strings use <code>char</code> as the core type.</li>
</ul>
<ul>
<li>Data transmitted to and from an external system using the <a class="el" href="serial_8h.html">serial abstraction</a> uses <code>uint8_t</code> as codified in <code>&lt;stdint.h&gt;</code>.</li>
</ul>
<ul>
<li>Any parameter that is a pointer to data the function is expected not to modify should include the appropriate <code>const</code> qualifier.</li>
</ul>
<h1><a class="anchor" id="coding_misc"></a>
Miscellaneous</h1>
<h2><a class="anchor" id="coding_misc_yoda"></a>
Comparison Operands</h2>
<p>BSP430 places comparison operands which are lvalues on the right side of the operator, as with:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (4 &lt;= len) {</div>
<div class="line">  <span class="comment">/* Too long */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Yes, even if the conditional operator "couldn't possibly be mistyped" as an assignment operator. <a href="http://www.dodgycoder.net/2011/11/yoda-conditions-pokemon-exception.html">Up with it you must put.</a></p>
<h2><a class="anchor" id="coding_misc_rv"></a>
Function Return Values</h2>
<p>Where a function implements an operation that may succeed or fail, that state reflected in the return value following standard POSIX conventions: a zero indicates a successful execution and a negative value indicates an error. Where useful information about a successful result may be expressed as a non-negative value (e.g., the number of bytes successfully transmitted), that may be included in the return value.</p>
<p>This is often counter-intuitive to programmers unfamiliar with POSIX, but the correct test to see whether the I2C addresses were successfully set is indeed:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (0 == iBSP430serialI2CsetAddresses_ni(i2c, oa, sa)) {</div>
<div class="line">  <span class="comment">/* Success here... */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="coding_misc_incl"></a>
Include Files</h2>
<p>Include file protection symbols encode the path by which the include file is normally accessed; e.g. the protection sequence for &lt;<a class="el" href="platform_2exp430fr5739_2platform_8h.html" title="Platform-specific include for MSP-EXP430FR5739 (&quot;Fraunchpad&quot;)">bsp430/platform/exp430fr5739/platform.h</a>&gt; is:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef BSP430_PLATFORM_EXP430FR5739_PLATFORM_H</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BSP430_PLATFORM_EXP430FR5739_PLATFORM_H</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">/* ... */</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* BSP430_PLATFORM_EXP430FR5739_PLATFORM_H */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><h2><a class="anchor" id="coding_misc_cpp"></a>
Preprocessor Feature Tests</h2>
<p>See also <a class="el" href="bsp430_config.html">BSP430 Configuration</a> for naming conventions and standards related to feature tests.</p>
<p>Where a macro value is used for conditional compilation, the state of being true is determined with the following pattern:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if FEATURE_FLAG - 0</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">/* Feature is enabled */</span></div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* MACRO_VALUE */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">/* Feature is not enabled */</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* MACRO_VALUE */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p>This technique allows use of:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define FEATURE_FLAG 0</span></div>
</div><!-- fragment --><p>to denote that the feature is being explicitly disabled. BSP430 should ensure that any feature test flag has a definition to either 1 or 0 (or to an expression that will evaluate to either a true or false value when used within a preprocessor condition). The documentation explicitly marks macro definitions that are expected to have such values with the following annotation:</p>
<dl class="section user"><dt>C Preprocessor Only:</dt><dd>This macro may have a value that permits its use only within C preprocessor conditional directives.</dd></dl>
<p>The ability to explicitly disable features that default to being enabled is critical and requires a value-based comparison. The subtraction of 0 in the conditional expression allows syntactic correctness when somebody inappropriately defines the feature flag with no value: such a case is equivalent to setting it false. The syntax also makes clear that the code was not intended to be <code>#ifdef FEATURE_FLAG</code>.</p>
<dl class="section warning"><dt>Warning</dt><dd>When features identified with null macro definitions are processed according to the BSP430 standard conditional directives, they are interpreted as being turned off, not on.</dd></dl>
<p>A common practice, followed by Texas Instruments in their standard MSP430 MCU-specific headers, is to use code like:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define __MSP430_HAS_USCI_B0__</span></div>
</div><!-- fragment --><p>with a null expansion to the macro. Here is simply the existence of a definition, not its value, that indicates feature is present.</p>
<p>The correct way of detecting features when interoperating with external libraries using the null-definition style is:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if defined(__MSP430_HAS_USCI_B0__) &amp;&amp; (configBSP430_HAL_USCI_B0 - 0)</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">/* Function is available and feature is enabled */</span></div>
<div class="line"><span class="preprocessor">#else </span><span class="comment">/* USCI_B0 */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">/* Function is missing or feature is disabled */</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* USCI_B0 */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p>The short-hand <code>#ifdef</code> may be used instead of the <code>defined()</code> test if no further conditions are required, but is discouraged for consistency.</p>
<p>In a very few cases, a <code>configFEATURE_FOO</code> flag is a request to supply a specific resource such as <code>BSP430_FOO_PERIPH_HANDLE</code>. If the platform is unable to provide the resource, it will leave the handle macro undefined When there is no independent reason also define a <code>FEATURE_FOO</code> flag, success of the configuration request should be tested by:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#if defined(BSP430_FOO_PERIPH_HANDLE)</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* FOO */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p>The documentation for <code>configFEATURE_FOO</code> and <code>BSP430_FOO_PERIPH_HANDLE</code> will indicate when this alternative success test should being used.</p>
<p>Copyright 2012-2013, Peter A. Bigot </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 25 2013 11:56:36 for BSP430 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
